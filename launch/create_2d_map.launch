<launch>

    <param name="use_sim_time" value="true"/>
    
    <arg name="pi/2" value="1.5707963267948966"/>
    <arg name="launch_static_tf"       default="true"/>
    <arg name="launch_rqt_reconfigure" default="true"/>
    <arg name="play_bag"               default="true"/>
    <arg name="sec"                    default="0"/>
    <arg name="rate"                   default="1"/>

    <arg name="bag_name"               default="2020-11-11-13-14-47_mapping_corcho2_no_odomtf"/>
    <arg name="bag_file"               default="$(env HOME)/radar_fusion_bags/$(arg bag_name).bag"/>
    
    <node name="bag_player" type="play" pkg="rosbag" 
          args="$(arg bag_file) --pause -r $(arg rate) --clock -s $(arg sec) -q -l" 
          output="screen" if="$(arg play_bag)"/>

  
    <arg name="pi"   value="3.141592654"/>
    
    <node pkg="odom_to_tf" type="odom_to_tf.py" name="odom_to_tf"> 
	  <param name="laser_frame" value="base_link"/>
	  <param name="rotate_90" value="false"/>
    </node> 
    
    <node pkg="pointcloud_to_laserscan" type="pointcloud_to_laserscan_node" name="pointcloud_to_laserscan">
        <remap from="cloud_in"            to="/os1_cloud_node/points_non_dense"/>
        <remap from="scan"                to="/os1_cloud_node/points_non_dense_laser_scan"/>
        <param name="min_height"          value="-0.2"/>
        <param name="max_height"          value="0.2"/>
        <param name="angle_min"           value="$(eval -1*arg('pi'))"/>
        <param name="angle_max"           value="$(eval arg('pi'))"/>
        <!-- <param name="angle_increment"     value="$(arg"/> -->
        <param name="queue_size"          value="1"/>
        <param name="scan_time"           value="0.1"/>
        <param name="range_min"           value="0.5"/>
        <param name="range_max"           value="120"/>
        <param name="target_frame"        value="os1_lidar"/>
        <param name="transform_tolerance" value="0.5"/>
    </node>

    <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping">
        <remap from="scan" to="os1_cloud_node/points_non_dense_laser_scan"/>
    </node>

    <!-- <node name="rviz" pkg="rviz" type="rviz" args="-d $(find radar_experiments)/rviz/fuse_sensors.rviz"/> -->
    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find radar_experiments)/rviz/gmapping.rviz"/>
    <!-- <node pkg="rqt_reconfigure" name="rqt_reconfigure" type="rqt_reconfigure" if="$(arg launch_rqt_reconfigure)"/> -->
    <node pkg="raposa_marker" type="raposa_marker" name="raposa_marker"/>
    <!-- Static TFs -->
    <node if="$(arg launch_static_tf)" pkg="tf" type="static_transform_publisher" name="os1_sensor_broadcaster" args="0.1 0 0.40 0 0 0               base_link  os1_sensor             10"/>
    <!--<node if="$(arg launch_static_tf)" pkg="tf" type="static_transform_publisher" name="tf_lidar"               args="0 0.0 0.03618 3.14 0.0 0.0     os1_sensor os1_lidar             10"/>
    <node if="$(arg launch_static_tf)" pkg="tf" type="static_transform_publisher" name="tf_radar_front"         args="0.09 0.04 -0.08 0 0 0          os1_sensor ti_mmwave_front_radar 10"/>
    <node if="$(arg launch_static_tf)" pkg="tf" type="static_transform_publisher" name="tf_radar_rear"          args="-0.33 0.05 -0.2 $(arg pi) 0 0  os1_sensor ti_mmwave_rear_radar  10"/>
    <node if="$(arg launch_static_tf)" pkg="tf" type="static_transform_publisher" name="tf_radar_right"         args="0 -0.05 -0.05 -$(arg pi/2) 0 0 os1_sensor ti_mmwave_right_radar 10"/>
    <node if="$(arg launch_static_tf)" pkg="tf" type="static_transform_publisher" name="tf_radar_left"          args="0 0.05 -0.05 $(arg pi/2) 0 0   os1_sensor ti_mmwave_left_radar  10"/> -->

</launch>